@{
    ViewData["Title"] = "Home Page";
}

<div class="container row gap-3 mt-3">
    <div class="col-md-12">
        <h3>Upload CSV File</h3>
        <input id="fileInput" class="form-control" type="file" />
    </div>

    <div class="col-md-12 mt-2">
        <button id="uploadBtn" class="btn btn-md btn-primary">Upload & Generate Template</button>
    </div>

    <div class="col-md-12 mt-2" id="downloadSection" style="display:none;">
        <a id="downloadLink" class="btn btn-success" href="#" target="_blank">Download Generated Template</a>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('uploadBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert('Please select a CSV file.');
                return;
            }

            const formData = new FormData();
            formData.append('csv', fileInput.files[0]);

                    try {
            const response = await fetch('https://localhost:7261/api/Render/RenderHtml', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error('Error uploading file.');

            const result = await response.json();
            console.log(result);

            if (result.uniqueFileName) {
                // Show download link
                const downloadLink = document.getElementById('downloadLink');
                downloadLink.href = `https://localhost:7261/api/Render/download/${result.uniqueFileName}`;
                document.getElementById('downloadSection').style.display = 'block';
            } else {
                alert('No file generated.');
            }
        } catch (err) {
            console.error(err);
            alert('Error processing file.');
        }
        });
    </script>
}
